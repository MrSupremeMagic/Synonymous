<!DOCTYPE html>
<html>

<head>

	<title>Game</title>
	<style>
		
		body{
			background-color:#eeffcc;
			margin:0;
			padding:0;
		}
		
		div.mainContainer{
			align-items:center;
			text-align:center;
			font-size:150%;
		}
		div.btmContainer{
			background-color:#f8feec;
			width:100%;
			text-align:center;
			align-items:center;
			font-size:350%;
			position:absolute;
			left:50%;
			bottom:-30px;
			transform: translate(-50%,-50%);
			padding:0px;
		}
		p{
			font-size:150%;
		}
		
		input{
			font-size:150%;
		}
		
		button{
			font-size:150%;
		}
		
		h1{
			border: 3px solid #cc9900;
			font-size:320%;
			align:centre;
			margin-top:0;
			text-align:center;
			padding:50px;
			background-color:#ffffe6;
		}

		
	</style>
</head>

<body>
	<p style="font-size:55%; vertical-align:top; color:#558000; position: absolute; margin-bottom:0;">Created by Evan Harmes</p>
	<h1><strong>Synonymous</strong></h1>
	<div class="mainContainer">
	<input type="date" id="calendar">
		<button onclick="submitDate()" style="font-size:125%;">Submit Date</button>
	</input>
	<p><span id="intro">Choose the closest word to:</span></p>
	<p><span id="word">Loading first word...</span></p>

	<input id="guess" type="text" placeholder="Input your guess">
	<button id="submit" onclick="submitGuess()">Submit</button>
	<p><span id="dailyScore"></span></p>
	<p><span id="score"></span></p>
	<br>
	<button id="continue" onclick="nextWord()" style="visibility:hidden;">Next Word</button>
	</div>
	<div class="btmContainer">
	<a href='Game.html' style="font-size:50%; color:#558000;" id="prevDay">Return to current day</a>
	</div>
</body>

<script>
let currentWord=null;
let wordNum=0;
let vectors = {};
let date = 0;
let dailyScore = 0;


async function loadGloVe() { 
	const response = await fetch("vectors_25k.json"); 
	vectors = await response.json(); 
	console.log("Loaded", Object.keys(vectors).length, "words");
	console.log("Fetch status:", response.ok);
	}

function nextWord(){
	document.getElementById("submit").disabled=false;
	const keys = Object.keys(vectors);
	wordNum+=1
	if (wordNum>10){
		document.getElementById("word").innerText=dailyScore;
		document.getElementById("guess").style.visibility="hidden";
		document.getElementById("intro").innerText="Your Final Score was: ";
		document.getElementById("score").style.visibility="hidden";
		document.getElementById("dailyScore").style.visibility="hidden";
		document.getElementById("continue").style.visibility="hidden";
		document.getElementById("submit").style.visibility="hidden";
		return;
	}
	else if (wordNum>1){
		document.getElementById("intro").innerText="Word "+ wordNum+ " is: ";
	}
	currentWord=keys[Math.floor((6,536,600/date)* keys.length)+wordNum];
	if (isNumber(currentWord)) {
		nextWord();	
		}
	document.getElementById("word").innerText=currentWord;
	document.getElementById("continue").style.visibility = "hidden";
	document.getElementById("guess").value="";
	console.log(currentWord);
}

function cosineSimilarity(a, b) { 
	let dot = 0, magA = 0, magB = 0; 
	for (let i = 0; i < a.length; i++) { 
		dot += a[i] * b[i]; 
		magA += a[i] * a[i]; 
		magB += b[i] * b[i]; 
	} return dot / (Math.sqrt(magA) * Math.sqrt(magB));
}

function submitGuess(){
	let guess = document.getElementById("guess").value.trim().toLowerCase();
	document.getElementById("submit").disabled=true;
	
	if (!vectors[guess]){
		document.getElementById("score").innerText = "Word not in dictionary.";
		document.getElementById("submit").disabled=false;		
		return;
	} else {
		document.getElementById("score").innerText = ""; 
	}

	const sim = cosineSimilarity(vectors[guess], vectors[currentWord.toLowerCase()]);
	dailyScore+=sim.toFixed(2)*100;
	document.getElementById("score").innerText = "Score: "+ sim.toFixed(2)*100;
	if (wordNum >= 2) {
		document.getElementById("dailyScore").innerText = "Total Score: " + dailyScore;
	}
	document.getElementById("continue").style.visibility = "visible";
}

function getDailySeed(checkDate) {
    let [y, m, d]=checkDate.split("-");
	console.log(y, m, d);
	d=Number(d*100);
	m=Number(m*10);
	y=Number(y);
	wordNum=0;
	score=0;
	document.getElementById("intro").innerText="Choose the closest word to:";
	return (d+m+y);
}

function getToday() {
	let today1 = new Date();
    let y1 = today1.getFullYear();
    let m1 = today1.getMonth() + 1;
	if (m1<10){m1="0"+m1}
    let d1 = today1.getDate();
	if (d1<10){d1="0"+d1}
	return `${y1}-${m1}-${d1}`;
}

function convertNewDate(checkDate){
	let [y, m, d]=checkDate.split("-");
	return (d*100+m*10+y);
}

function submitDate(){
	let checkDate = document.getElementById("calendar").value;
	if (checkDate > getToday()){
		document.getElementById("calendar").value=getToday();
	}
	else {
		console.log("current",date);
		date = getDailySeed(checkDate);
		console.log(date);
		nextWord();
	}
}

function isNumber(value) {
	return /\d/.test(value);
}


window.onload = loadGloVe();

</script>

</html>
